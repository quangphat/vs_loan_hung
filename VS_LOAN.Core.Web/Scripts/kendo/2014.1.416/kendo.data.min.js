/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.core.min","./kendo.data.odata.min","./kendo.data.xml.min"],e)}(function(){return function(e,t){function n(e,t,n,i){return function(r){var a,o={};for(a in r)o[a]=r[a];o.field=i?n+"."+r.field:n,t==vt&&e._notifyChange&&e._notifyChange(o),e.trigger(t,o)}}function i(t,n){if(t===n)return!0;var r,a=e.type(t),o=e.type(n);if(a!==o)return!1;if("date"===a)return t.getTime()===n.getTime();if("object"!==a&&"array"!==a)return!1;for(r in t)if(!i(t[r],n[r]))return!1;return!0}function r(e,t){var n,i;for(i in e){if(n=e[i],et(n)&&n.field&&n.field===t)return n;if(n===t)return n}return null}function a(e){this.data=e||[]}function o(e,n){if(e){var i=typeof e===dt?{field:e,dir:n}:e,r=nt(i)?i:i!==t?[i]:[];return it(r,function(e){return!!e.dir})}}function s(e){var t,n,i,r,a=e.filters;if(a)for(t=0,n=a.length;n>t;t++)i=a[t],r=i.operator,r&&typeof r===dt&&(i.operator=L[r.toLowerCase()]||r),s(i)}function l(e){return e&&!tt(e)?((nt(e)||!e.filters)&&(e={logic:"and",filters:nt(e)?e:[e]}),s(e),e):t}function u(e){return nt(e)?e:[e]}function c(e,n){var i=typeof e===dt?{field:e,dir:n}:e,r=nt(i)?i:i!==t?[i]:[];return N(r,function(e){return{field:e.field,dir:e.dir||"asc",aggregates:e.aggregates}})}function d(e,t){return e&&e.getTime&&t&&t.getTime?e.getTime()===t.getTime():e===t}function f(e,t,n,i,r,a){var o,s,l,u,c;for(t=t||[],u=t.length,o=0;u>o;o++)s=t[o],l=s.aggregate,c=s.field,e[c]=e[c]||{},a[c]=a[c]||{},a[c][l]=a[c][l]||{},e[c][l]=U[l.toLowerCase()](e[c][l],n,st.accessor(c),i,r,a[c][l])}function h(e){return"number"==typeof e&&!isNaN(e)}function p(e){var t,n=e.length,i=Array(n);for(t=0;n>t;t++)i[t]=e[t].toJSON();return i}function g(e,t){t=t||{};var n=new a(e),i=t.aggregate,r=t.filter;return r&&(n=n.filter(r)),n.aggregate(i)}function m(e,t,n,i,r){var a,o,s,l,u;for(l=0,u=e.length;u>l;l++){a=e[l];for(o in t)s=r[o],s&&s!==o&&(a[s]=t[o](a),delete a[o])}}function v(e,t,n,i,r){var a,o,s,l,u;for(l=0,u=e.length;u>l;l++){a=e[l];for(o in t)a[o]=n._parse(o,t[o](a)),s=r[o],s&&s!==o&&delete a[s]}}function _(e,t,n,i,r){var a,o,s,l;for(o=0,l=e.length;l>o;o++)a=e[o],s=i[a.field],s&&s!=a.field&&(a.field=s),a.value=n._parse(a.field,a.value),a.hasSubgroups?_(a.items,t,n,i,r):v(a.items,t,n,i,r)}function y(e,t,n,i,r,a){return function(o){return o=e(o),o&&!tt(i)&&("[object Array]"===Nt.call(o)||o instanceof Ut||(o=[o]),n(o,i,new t,r,a)),o||[]}}function b(e,t,n,i){for(var r,a,o,s=0;t.length&&i&&(r=t[s],a=r.items,o=a.length,e&&e.field===r.field&&e.value===r.value?(e.hasSubgroups&&e.items.length?b(e.items[e.items.length-1],r.items,n,i):(a=a.slice(n,n+i),e.items=e.items.concat(a)),t.splice(s--,1)):r.hasSubgroups&&a.length?b(r,a,n,i):(a=a.slice(n,n+i),r.items=a,r.items.length||t.splice(s--,1)),0===a.length?n-=o:(n=0,i-=a.length),!(++s>=t.length)););t.length>s&&t.splice(s,t.length-s)}function w(e){var t,n,i=[];for(t=0,n=e.length;n>t;t++)i=e[t].hasSubgroups?i.concat(w(e[t].items)):i.concat(e[t].items.slice());return i}function C(e,t){var n,i,r,a;if(t)for(n=0,i=e.length;i>n;n++)r=e[n],a=r.items,r.hasSubgroups?C(a,t):!a.length||a[0]instanceof t||(a.type=t,a.wrapAll(a,a))}function k(e,t){var n,i;for(n=0,i=e.length;i>n;n++)if(e[n].hasSubgroups){if(k(e[n].items,t))return!0}else if(t(e[n].items,e[n]))return!0}function F(e,t){var n,i;for(n=0,i=e.length;i>n;n++)if(e[n].uid==t.uid)return t=e[n],e.splice(n,1),t}function x(e,t){var n,i,r,a;for(r=e.length-1,a=0;r>=a;r--)i=e[r],n={value:t.get(i.field),field:i.field,items:n?[n]:[t],hasSubgroups:!!n,aggregates:{}};return n}function S(e,t){return t?T(e,function(e){return e[t.idField]===t.id}):-1}function M(e,t){return t?T(e,function(e){return e.uid==t.uid}):-1}function T(e,t){var n,i;for(n=0,i=e.length;i>n;n++)if(t(e[n]))return n;return-1}function D(e,t){var n,i;return e&&!tt(e)?(n=e[t],i=et(n)?n.from||n.field||t:e[t]||t,lt(i)?t:i):t}function O(e,t){var n,i,r,a={};for(r in e)"filters"!==r&&(a[r]=e[r]);if(e.filters)for(a.filters=[],n=0,i=e.filters.length;i>n;n++)a.filters[n]=O(e.filters[n],t);else a.field=D(t.fields,a.field);return a}function A(e,t){var n,i,r,a,o,s=[];for(n=0,i=e.length;i>n;n++){r={},a=e[n];for(o in a)r[o]=a[o];r.field=D(t.fields,r.field),r.aggregates&&nt(r.aggregates)&&(r.aggregates=A(r.aggregates,t)),s.push(r)}return s}function z(t,n){var i,r,a,o,s,l=e(t)[0].children,u=[],c=n[0],d=n[1];for(i=0,r=l.length;r>i;i++)a={},s=l[i],s.disabled||(a[c.field]=s.text,o=s.attributes.value,o=o&&o.specified?s.value:s.text,a[d.field]=o,u.push(a));return u}function E(t,n){var i,r,a,o,s,l,u,c=e(t)[0].tBodies[0],d=c?c.rows:[],f=n.length,h=[];for(i=0,r=d.length;r>i;i++){for(s={},u=!0,o=d[i].cells,a=0;f>a;a++)l=o[a],"th"!==l.nodeName.toLowerCase()&&(u=!1,s[n[a].field]=l.innerHTML);u||h.push(s)}return h}function H(e){return function(){var t=this._data,n=W.fn[e].apply(this,Ht.call(arguments));return this._data!=t&&this._attachBubbleHandlers(),n}}function I(t,n){function i(e,t){return e.filter(t).add(e.find(t))}var r,a,o,s,l,u,c,d,f=e(t).children(),h=[],p=n[0].field,g=n[1]&&n[1].field,m=n[2]&&n[2].field,v=n[3]&&n[3].field;for(r=0,a=f.length;a>r;r++)o={_loaded:!0},s=f.eq(r),u=s[0].firstChild,d=s.children(),t=d.filter("ul"),d=d.filter(":not(ul)"),l=s.attr("data-id"),l&&(o.id=l),u&&(o[p]=3==u.nodeType?u.nodeValue:d.text()),g&&(o[g]=i(d,"a").attr("href")),v&&(o[v]=i(d,"img").attr("src")),m&&(c=i(d,".k-sprite").prop("className"),o[m]=c&&e.trim(c.replace("k-sprite",""))),t.length&&(o.items=I(t.eq(0),n)),"true"==s.attr("data-hasChildren")&&(o.hasChildren=!0),h.push(o);return h}var N,P,B,R,L,U,q,j,Y,V,W,G,J,$,K,Q,Z=e.extend,X=e.proxy,et=e.isPlainObject,tt=e.isEmptyObject,nt=e.isArray,it=e.grep,rt=e.ajax,at=e.each,ot=e.noop,st=window.kendo,lt=st.isFunction,ut=st.Observable,ct=st.Class,dt="string",ft="function",ht="create",pt="read",gt="update",mt="destroy",vt="change",_t="sync",yt="get",bt="error",wt="requestStart",Ct="progress",kt="requestEnd",Ft=[ht,pt,gt,mt],xt=function(e){return e},St=st.getter,Mt=st.stringify,Tt=Math,Dt=[].push,Ot=[].join,At=[].pop,zt=[].splice,Et=[].shift,Ht=[].slice,It=[].unshift,Nt={}.toString,Pt=st.support.stableSort,Bt=/^\/Date\((.*?)\)\/$/,Rt=/(\r+|\n+)/g,Lt=/(?=['\\])/g,Ut=ut.extend({init:function(e,t){var n=this;n.type=t||qt,ut.fn.init.call(n),n.length=e.length,n.wrapAll(e,n)},toJSON:function(){var e,t,n=this.length,i=Array(n);for(e=0;n>e;e++)t=this[e],t instanceof qt&&(t=t.toJSON()),i[e]=t;return i},parent:ot,wrapAll:function(e,t){var n,i,r=this,a=function(){return r};for(t=t||[],n=0,i=e.length;i>n;n++)t[n]=r.wrap(e[n],a);return t},wrap:function(e,t){var n,i=this;return null!==e&&"[object Object]"===Nt.call(e)&&(n=e instanceof i.type||e instanceof Vt,n||(e=e instanceof qt?e.toJSON():e,e=new i.type(e)),e.parent=t,e.bind(vt,function(e){i.trigger(vt,{field:e.field,node:e.node,index:e.index,items:e.items||[this],action:e.node?e.action||"itemchange":"itemchange"})})),e},push:function(){var e,t=this.length,n=this.wrapAll(arguments);return e=Dt.apply(this,n),this.trigger(vt,{action:"add",index:t,items:n}),e},slice:Ht,join:Ot,pop:function(){var e=this.length,t=At.apply(this);return e&&this.trigger(vt,{action:"remove",index:e-1,items:[t]}),t},splice:function(e,t,n){var i,r,a,o=this.wrapAll(Ht.call(arguments,2));if(i=zt.apply(this,[e,t].concat(o)),i.length)for(this.trigger(vt,{action:"remove",index:e,items:i}),r=0,a=i.length;a>r;r++)i[r].children&&i[r].unbind(vt);return n&&this.trigger(vt,{action:"add",index:e,items:o}),i},shift:function(){var e=this.length,t=Et.apply(this);return e&&this.trigger(vt,{action:"remove",index:0,items:[t]}),t},unshift:function(){var e,t=this.wrapAll(arguments);return e=It.apply(this,t),this.trigger(vt,{action:"add",index:0,items:t}),e},indexOf:function(e){var t,n,i=this;for(t=0,n=i.length;n>t;t++)if(i[t]===e)return t;return-1},forEach:function(e){for(var t=0,n=this.length;n>t;t++)e(this[t],t,this)},map:function(e){for(var t=0,n=[],i=this.length;i>t;t++)n[t]=e(this[t],t,this);return n},filter:function(e){for(var t,n=0,i=[],r=this.length;r>n;n++)t=this[n],e(t,n,this)&&(i[i.length]=t);return i},find:function(e){for(var t,n=0,i=this.length;i>n;n++)if(t=this[n],e(t,n,this))return t},every:function(e){for(var t,n=0,i=this.length;i>n;n++)if(t=this[n],!e(t,n,this))return!1;return!0},some:function(e){for(var t,n=0,i=this.length;i>n;n++)if(t=this[n],e(t,n,this))return!0;return!1},remove:function(e){this.splice(this.indexOf(e),1)},empty:function(){this.splice(0,this.length)}}),qt=ut.extend({init:function(e){var t,n,i=this,r=function(){return i};ut.fn.init.call(this);for(n in e)t=e[n],"_"!=n.charAt(0)&&(t=i.wrap(t,n,r)),i[n]=t;i.uid=st.guid()},shouldSerialize:function(e){return this.hasOwnProperty(e)&&"_events"!==e&&typeof this[e]!==ft&&"uid"!==e},forEach:function(e){for(var t in this)this.shouldSerialize(t)&&e(this[t],t)},toJSON:function(){var e,t,n={};for(t in this)this.shouldSerialize(t)&&(e=this[t],(e instanceof qt||e instanceof Ut)&&(e=e.toJSON()),n[t]=e);return n},get:function(e){var t,n=this;return n.trigger(yt,{field:e}),t="this"===e?n:st.getter(e,!0)(n)},_set:function(e,t){var n,i,r,a=this,o=e.indexOf(".")>=0;if(o)for(n=e.split("."),i="";n.length>1;){if(i+=n.shift(),r=st.getter(i,!0)(a),r instanceof qt)return r.set(n.join("."),t),o;i+="."}return st.setter(e)(a,t),o},set:function(e,t){var n=this,i=e.indexOf(".")>=0,r=st.getter(e,!0)(n);r!==t&&(n.trigger("set",{field:e,value:t})||(i||(t=n.wrap(t,e,function(){return n})),(!n._set(e,t)||e.indexOf("(")>=0||e.indexOf("[")>=0)&&n.trigger(vt,{field:e})))},parent:ot,wrap:function(e,t,i){var r,a,o=this,s=Nt.call(e);return null==e||"[object Object]"!==s&&"[object Array]"!==s||(r=e instanceof Ut,a=e instanceof W,"[object Object]"!==s||a||r?("[object Array]"===s||r||a)&&(r||a||(e=new Ut(e)),e.parent()!=i()&&e.bind(vt,n(o,vt,t,!1))):(e instanceof qt||(e=new qt(e)),e.parent()!=i()&&(e.bind(yt,n(o,yt,t,!0)),e.bind(vt,n(o,vt,t,!0)))),e.parent=i),e}}),jt={number:function(e){return st.parseFloat(e)},date:function(e){return st.parseDate(e)},"boolean":function(e){return typeof e===dt?"true"===e.toLowerCase():null!=e?!!e:e},string:function(e){return null!=e?e+"":e},"default":function(e){return e}},Yt={string:"",number:0,date:new Date,"boolean":!1,"default":""},Vt=qt.extend({init:function(n){var i=this;(!n||e.isEmptyObject(n))&&(n=e.extend({},i.defaults,n)),qt.fn.init.call(i,n),i.dirty=!1,i.idField&&(i.id=i.get(i.idField),i.id===t&&(i.id=i._defaultId))},shouldSerialize:function(e){return qt.fn.shouldSerialize.call(this,e)&&"uid"!==e&&!("id"!==this.idField&&"id"===e)&&"dirty"!==e&&"_accessors"!==e},_parse:function(e,t){var n,i=this,a=e,o=i.fields||{};return e=o[e],e||(e=r(o,a)),e&&(n=e.parse,!n&&e.type&&(n=jt[e.type.toLowerCase()])),n?n(t):t},_notifyChange:function(e){var t=e.action;("add"==t||"remove"==t)&&(this.dirty=!0)},editable:function(e){return e=(this.fields||{})[e],e?e.editable!==!1:!0},set:function(e,t,n){var r=this;r.editable(e)&&(t=r._parse(e,t),i(t,r.get(e))||(r.dirty=!0,qt.fn.set.call(r,e,t,n)))},accept:function(e){var t,n,i=this,r=function(){return i};for(t in e)n=e[t],"_"!=t.charAt(0)&&(n=i.wrap(e[t],t,r)),i._set(t,n);i.idField&&(i.id=i.get(i.idField)),i.dirty=!1},isNew:function(){return this.id===this._defaultId}});Vt.define=function(e,n){n===t&&(n=e,e=Vt);var i,r,a,o,s,l,u,c,d=Z({defaults:{}},n),f={},h=d.id;if(h&&(d.idField=h),d.id&&delete d.id,h&&(d.defaults[h]=d._defaultId=""),"[object Array]"===Nt.call(d.fields)){for(l=0,u=d.fields.length;u>l;l++)a=d.fields[l],typeof a===dt?f[a]={}:a.field&&(f[a.field]=a);d.fields=f}for(r in d.fields)a=d.fields[r],o=a.type||"default",s=null,c=r,r=typeof a.field===dt?a.field:r,a.nullable||(s=d.defaults[c!==r?c:r]=a.defaultValue!==t?a.defaultValue:Yt[o.toLowerCase()]),n.id===r&&(d._defaultId=s),d.defaults[c!==r?c:r]=s,a.parse=a.parse||jt[o];return i=e.extend(d),i.define=function(e){return Vt.define(i,e)},d.fields&&(i.fields=d.fields,i.idField=d.idField),i},P={selector:function(e){return lt(e)?e:St(e)},compare:function(e){var t=this.selector(e);return function(e,n){return e=t(e),n=t(n),null==e&&null==n?0:null==e?-1:null==n?1:e.localeCompare?e.localeCompare(n):e>n?1:n>e?-1:0}},create:function(e){var t=e.compare||this.compare(e.field);return"desc"==e.dir?function(e,n){return t(n,e,!0)}:t},combine:function(e){return function(t,n){var i,r,a=e[0](t,n);for(i=1,r=e.length;r>i;i++)a=a||e[i](t,n);return a}}},B=Z({},P,{asc:function(e){var t=this.selector(e);return function(e,n){var i=t(e),r=t(n);return i&&i.getTime&&r&&r.getTime&&(i=i.getTime(),r=r.getTime()),i===r?e.__position-n.__position:null==i?-1:null==r?1:i.localeCompare?i.localeCompare(r):i>r?1:-1}},desc:function(e){var t=this.selector(e);return function(e,n){var i=t(e),r=t(n);return i&&i.getTime&&r&&r.getTime&&(i=i.getTime(),r=r.getTime()),i===r?e.__position-n.__position:null==i?1:null==r?-1:r.localeCompare?r.localeCompare(i):r>i?1:-1}},create:function(e){return this[e.dir](e.field)}}),N=function(e,t){var n,i=e.length,r=Array(i);for(n=0;i>n;n++)r[n]=t(e[n],n,e);return r},R=function(){function e(e){return e.replace(Lt,"\\").replace(Rt,"")}function t(t,n,i,r){var a;return null!=i&&(typeof i===dt&&(i=e(i),a=Bt.exec(i),a?i=new Date(+a[1]):r?(i="'"+i.toLowerCase()+"'",n="("+n+" || '').toLowerCase()"):i="'"+i+"'"),i.getTime&&(n="("+n+"?"+n+".getTime():"+n+")",i=i.getTime())),n+" "+t+" "+i}return{eq:function(e,n,i){return t("==",e,n,i)},neq:function(e,n,i){return t("!=",e,n,i)},gt:function(e,n,i){return t(">",e,n,i)},gte:function(e,n,i){return t(">=",e,n,i)},lt:function(e,n,i){return t("<",e,n,i)},lte:function(e,n,i){return t("<=",e,n,i)},startswith:function(t,n,i){return i&&(t="("+t+" || '').toLowerCase()",n&&(n=n.toLowerCase())),n&&(n=e(n)),t+".lastIndexOf('"+n+"', 0) == 0"},endswith:function(t,n,i){return i&&(t="("+t+" || '').toLowerCase()",n&&(n=n.toLowerCase())),n&&(n=e(n)),t+".indexOf('"+n+"', "+t+".length - "+(n||"").length+") >= 0"},contains:function(t,n,i){return i&&(t="("+t+" || '').toLowerCase()",n&&(n=n.toLowerCase())),n&&(n=e(n)),t+".indexOf('"+n+"') >= 0"},doesnotcontain:function(t,n,i){return i&&(t="("+t+" || '').toLowerCase()",n&&(n=n.toLowerCase())),n&&(n=e(n)),t+".indexOf('"+n+"') == -1"}}}(),a.filterExpr=function(e){var n,i,r,o,s,l,u=[],c={and:" && ",or:" || "},d=[],f=[],h=e.filters;for(n=0,i=h.length;i>n;n++)r=h[n],s=r.field,l=r.operator,r.filters?(o=a.filterExpr(r),r=o.expression.replace(/__o\[(\d+)\]/g,function(e,t){return t=+t,"__o["+(f.length+t)+"]"}).replace(/__f\[(\d+)\]/g,function(e,t){return t=+t,"__f["+(d.length+t)+"]"}),f.push.apply(f,o.operators),d.push.apply(d,o.fields)):(typeof s===ft?(o="__f["+d.length+"](d)",d.push(s)):o=st.expr(s),typeof l===ft?(r="__o["+f.length+"]("+o+", "+r.value+")",f.push(l)):r=R[(l||"eq").toLowerCase()](o,r.value,r.ignoreCase!==t?r.ignoreCase:!0)),u.push(r);return{expression:"("+u.join(c[e.logic])+")",fields:d,operators:f}},L={"==":"eq",equals:"eq",isequalto:"eq",equalto:"eq",equal:"eq","!=":"neq",ne:"neq",notequals:"neq",isnotequalto:"neq",notequalto:"neq",notequal:"neq","<":"lt",islessthan:"lt",lessthan:"lt",less:"lt","<=":"lte",le:"lte",islessthanorequalto:"lte",lessthanequal:"lte",">":"gt",isgreaterthan:"gt",greaterthan:"gt",greater:"gt",">=":"gte",isgreaterthanorequalto:"gte",greaterthanequal:"gte",ge:"gte",notsubstringof:"doesnotcontain"},a.normalizeFilter=l,a.prototype={toArray:function(){return this.data},range:function(e,t){return new a(this.data.slice(e,e+t))},skip:function(e){return new a(this.data.slice(e))},take:function(e){return new a(this.data.slice(0,e))},select:function(e){return new a(N(this.data,e))},order:function(e,t){var n={dir:t};return e&&(e.compare?n.compare=e.compare:n.field=e),new a(this.data.slice(0).sort(P.create(n)))},orderBy:function(e){return this.order(e,"asc")},orderByDescending:function(e){return this.order(e,"desc")},sort:function(e,t,n){var i,r,a=o(e,t),s=[];if(n=n||P,a.length){for(i=0,r=a.length;r>i;i++)s.push(n.create(a[i]));return this.orderBy({compare:n.combine(s)})}return this},filter:function(e){var t,n,i,r,o,s,u,c,d=this.data,f=[];if(e=l(e),!e||0===e.filters.length)return this;for(r=a.filterExpr(e),s=r.fields,u=r.operators,o=c=Function("d, __f, __o","return "+r.expression),(s.length||u.length)&&(c=function(e){return o(e,s,u)}),t=0,i=d.length;i>t;t++)n=d[t],c(n)&&f.push(n);return new a(f)},group:function(e,t){e=c(e||[]),t=t||this.data;var n,i=this,r=new a(i.data);return e.length>0&&(n=e[0],r=r.groupBy(n).select(function(i){var r=new a(t).filter([{field:i.field,operator:"eq",value:i.value,ignoreCase:!1}]);return{field:i.field,value:i.value,items:e.length>1?new a(i.items).group(e.slice(1),r.toArray()).toArray():i.items,hasSubgroups:e.length>1,aggregates:r.aggregate(n.aggregates)}})),r},groupBy:function(e){if(tt(e)||!this.data.length)return new a([]);var t,n,i,r,o=e.field,s=this._sortForGrouping(o,e.dir||"asc"),l=st.accessor(o),u=l.get(s[0],o),c={field:o,value:u,items:[]},f=[c];for(i=0,r=s.length;r>i;i++)t=s[i],n=l.get(t,o),d(u,n)||(u=n,c={field:o,value:u,items:[]},f.push(c)),c.items.push(t);return new a(f)},_sortForGrouping:function(e,t){var n,i,r=this.data;if(!Pt){for(n=0,i=r.length;i>n;n++)r[n].__position=n;for(r=new a(r).sort(e,t,B).toArray(),n=0,i=r.length;i>n;n++)delete r[n].__position;return r}return this.sort(e,t).toArray()},aggregate:function(e){var t,n,i={},r={};if(e&&e.length)for(t=0,n=this.data.length;n>t;t++)f(i,e,this.data[t],t,n,r);return i}},U={sum:function(e,t,n){var i=n.get(t);return h(e)?h(i)&&(e+=i):e=i,e},count:function(e){return(e||0)+1},average:function(e,n,i,r,a,o){var s=i.get(n);return o.count===t&&(o.count=0),h(e)?h(s)&&(e+=s):e=s,h(s)&&o.count++,r==a-1&&h(e)&&(e/=o.count),e},max:function(e,t,n){var i=n.get(t);return h(e)||(e=i),i>e&&h(i)&&(e=i),e},min:function(e,t,n){var i=n.get(t);return h(e)||(e=i),e>i&&h(i)&&(e=i),e}},a.process=function(e,n){n=n||{};var i,r=new a(e),s=n.group,l=c(s||[]).concat(o(n.sort||[])),u=n.filter,d=n.skip,f=n.take;return u&&(r=r.filter(u),i=r.toArray().length),l&&(r=r.sort(l),s&&(e=r.toArray())),d!==t&&f!==t&&(r=r.range(d,f)),s&&(r=r.group(s,e)),{total:i,data:r.toArray()}},q=ct.extend({init:function(e){this.data=e.data},read:function(e){e.success(this.data)},update:function(e){e.success(e.data)},create:function(e){e.success(e.data)},destroy:function(e){e.success(e.data)}}),j=ct.extend({init:function(e){var t,n=this;e=n.options=Z({},n.options,e),at(Ft,function(t,n){typeof e[n]===dt&&(e[n]={url:e[n]})}),n.cache=e.cache?Y.create(e.cache):{find:ot,add:ot},t=e.parameterMap,lt(e.push)&&(n.push=e.push),n.push||(n.push=xt),n.parameterMap=lt(t)?t:function(e){var n={};return at(e,function(e,i){e in t&&(e=t[e],et(e)&&(i=e.value(i),e=e.key)),n[e]=i}),n}},options:{parameterMap:xt},create:function(e){return rt(this.setup(e,ht))},read:function(n){var i,r,a,o=this,s=o.cache;n=o.setup(n,pt),i=n.success||ot,r=n.error||ot,a=s.find(n.data),a!==t?i(a):(n.success=function(e){s.add(n.data,e),i(e)},e.ajax(n))},update:function(e){return rt(this.setup(e,gt))},destroy:function(e){return rt(this.setup(e,mt))},setup:function(e,t){e=e||{};var n,i=this,r=i.options[t],a=lt(r.data)?r.data(e.data):r.data;return e=Z(!0,{},r,e),n=Z(!0,{},a,e.data),e.data=i.parameterMap(n,t),lt(e.url)&&(e.url=e.url(n)),e}}),Y=ct.extend({init:function(){this._store={}},add:function(e,n){e!==t&&(this._store[Mt(e)]=n)},find:function(e){return this._store[Mt(e)]},clear:function(){this._store={}},remove:function(e){delete this._store[Mt(e)]}}),Y.create=function(e){var t={inmemory:function(){return new Y}};return et(e)&&lt(e.find)?e:e===!0?new Y:t[e]()},V=ct.extend({init:function(e){var t,n,i,r,a,o,s,l,u,c,d,f,h,p=this;e=e||{};for(t in e)n=e[t],p[t]=typeof n===dt?St(n):n;r=e.modelBase||Vt,et(p.model)&&(p.model=i=r.define(p.model)),p.model&&(a=X(p.data,p),o=X(p.groups,p),s=X(p.serialize,p),l={},u={},c={},d={},f=!1,i=p.model,i.fields&&(at(i.fields,function(e,t){var n;h=e,et(t)&&t.field?h=t.field:typeof t===dt&&(h=t),et(t)&&t.from&&(n=t.from),f=f||n&&n!==e||h!==e,u[e]=St(n||h),c[e]=St(e),l[n||h]=e,d[e]=n||h}),!e.serialize&&f&&(p.serialize=y(s,i,m,c,l,d))),p._dataAccessFunction=a,p.data=y(a,i,v,u,l,d),p.groups=y(o,i,_,u,l,d))},errors:function(e){return e?e.errors:null},parse:xt,data:xt,total:function(e){return e.length},groups:xt,aggregates:function(){return{}},serialize:function(e){return e}}),W=ut.extend({init:function(e){var n,i,r=this;e&&(i=e.data),e=r.options=Z({},r.options,e),r._map={},r._prefetch={},r._data=[],r._pristineData=[],r._ranges=[],r._view=[],r._pristineTotal=0,r._destroyed=[],r._pageSize=e.pageSize,r._page=e.page||(e.pageSize?1:t),r._sort=o(e.sort),r._filter=l(e.filter),r._group=c(e.group),r._aggregate=e.aggregate,r._total=e.total,ut.fn.init.call(r),r.transport=G.create(e,i),lt(r.transport.push)&&r.transport.push({pushCreate:X(r._pushCreate,r),pushUpdate:X(r._pushUpdate,r),pushDestroy:X(r._pushDestroy,r)}),r.reader=new st.data.readers[e.schema.type||"json"](e.schema),n=r.reader.model||{},r._data=r._observe(r._data),r.bind(["push",bt,vt,wt,_t,kt,Ct],e)},options:{data:[],schema:{modelBase:Vt},serverSorting:!1,serverPaging:!1,serverFiltering:!1,serverGrouping:!1,serverAggregates:!1,batch:!1},_isServerGrouped:function(){var e=this.group()||[];return this.options.serverGrouping&&e.length},_pushCreate:function(e){this._push(e,"pushCreate")},_pushUpdate:function(e){this._push(e,"pushUpdate")},_pushDestroy:function(e){this._push(e,"pushDestroy")},_push:function(e,t){var n=this._readData(e);n||(n=e),this[t](n)},_flatData:function(e){return this._isServerGrouped()?w(e):e},parent:ot,get:function(e){var t,n,i=this._flatData(this._data);for(t=0,n=i.length;n>t;t++)if(i[t].id==e)return i[t]},getByUid:function(e){var t,n,i=this._flatData(this._data);if(i)for(t=0,n=i.length;n>t;t++)if(i[t].uid==e)return i[t]},indexOf:function(e){return M(this._data,e)},at:function(e){return this._data[e]},data:function(e){var n=this;return e===t?n._data:(n._data=this._observe(e),n._pristineData=e.slice(0),n._ranges=[],n._addRange(n._data),n._total=n._data.length,n._pristineTotal=n._total,n._process(n._data),t)},view:function(){return this._view},add:function(e){return this.insert(this._data.length,e)},_createNewModel:function(e){return this.reader.model?new this.reader.model(e):new qt(e)},insert:function(e,t){return t||(t=e,e=0),t instanceof Vt||(t=this._createNewModel(t)),this._isServerGrouped()?this._data.splice(e,0,x(this.group(),t)):this._data.splice(e,0,t),t},pushCreate:function(e){var t,n,i,r,a;for(nt(e)||(e=[e]),t=[],n=0;e.length>n;n++)i=e[n],r=this.add(i),t.push(r),a=r.toJSON(),this._isServerGrouped()&&(a=x(this.group(),a)),this._pristineData.push(a);t.length&&this.trigger("push",{type:"create",items:t})},pushUpdate:function(e){var t,n,i,r,a;for(nt(e)||(e=[e]),t=[],n=0;e.length>n;n++)i=e[n],r=this._createNewModel(i),a=this.get(r.id),a?(t.push(a),a.accept(i),a.trigger("change"),this._updatePristineForModel(a,i)):this.pushCreate(i);t.length&&this.trigger("push",{type:"update",items:t})},pushDestroy:function(e){var t,n,i,r,a,o;nt(e)||(e=[e]),t=[],n=this.options.autoSync,this.options.autoSync=!1;try{for(i=0;e.length>i;i++)r=e[i],a=this._createNewModel(r),o=!1,this._eachItem(this._data,function(e){for(var n=0;e.length>n;n++)if(e[n].id===a.id){t.push(e[n]),e.splice(n,1),o=!0;break}}),o&&(this._removePristineForModel(a),this._destroyed.pop())}finally{this.options.autoSync=n}t.length&&this.trigger("push",{type:"destroy",items:t})},remove:function(e){var n,i=this,r=i._isServerGrouped();return this._eachItem(i._data,function(a){return n=F(a,e),n&&r?(n.isNew&&n.isNew()||i._destroyed.push(n),!0):t}),this._removeModelFromRanges(e),this._updateRangesLength(),e},sync:function(){var t,n,i,r=this,a=[],o=[],s=r._destroyed,l=r._flatData(r._data);if(r.reader.model){for(t=0,n=l.length;n>t;t++)l[t].isNew()?a.push(l[t]):l[t].dirty&&o.push(l[t]);i=r._send("create",a),i.push.apply(i,r._send("update",o)),i.push.apply(i,r._send("destroy",s)),e.when.apply(null,i).then(function(){var e,t;for(e=0,t=arguments.length;t>e;e++)r._accept(arguments[e]);r._change({action:"sync"}),r.trigger(_t)})}},cancelChanges:function(e){var t=this;e instanceof st.data.Model?t._cancelModel(e):(t._destroyed=[],t._data=t._observe(t._pristineData),t.options.serverPaging&&(t._total=t._pristineTotal),t._change())},hasChanges:function(){var e,t,n=this._data;if(this._destroyed.length)return!0;for(e=0,t=n.length;t>e;e++)if(n[e].isNew()||n[e].dirty)return!0;return!1},_accept:function(t){var n,i=this,r=t.models,a=t.response,o=0,s=i._isServerGrouped(),l=i._pristineData,u=t.type;if(i.trigger(kt,{response:a,type:u}),a&&!tt(a)){if(a=i.reader.parse(a),i._handleCustomErrors(a))return;a=i.reader.data(a),nt(a)||(a=[a])}else a=e.map(r,function(e){return e.toJSON()});for("destroy"===u&&(i._destroyed=[]),o=0,n=r.length;n>o;o++)"destroy"!==u?(r[o].accept(a[o]),"create"===u?l.push(s?x(i.group(),r[o]):a[o]):"update"===u&&i._updatePristineForModel(r[o],a[o])):i._removePristineForModel(r[o])},_updatePristineForModel:function(e,t){this._executeOnPristineForModel(e,function(e,n){st.deepExtend(n[e],t)})},_executeOnPristineForModel:function(e,n){this._eachPristineItem(function(i){var r=S(i,e);return r>-1?(n(r,i),!0):t})},_removePristineForModel:function(e){this._executeOnPristineForModel(e,function(e,t){t.splice(e,1)})},_readData:function(e){var t=this._isServerGrouped()?this.reader.groups:this.reader.data;return t(e)},_eachPristineItem:function(e){this._eachItem(this._pristineData,e)},_eachItem:function(e,t){e&&e.length&&(this._isServerGrouped()?k(e,t):t(e))},_pristineForModel:function(e){var n,i,r=function(r){return i=S(r,e),i>-1?(n=r[i],!0):t};return this._eachPristineItem(r),n},_cancelModel:function(e){var t,n=this._pristineForModel(e);this._eachItem(this._data,function(i){t=M(i,e),-1!=t&&(!e.isNew()&&n?i[t].accept(n):i.splice(t,1))})},_promise:function(t,n,i){var r=this,a=r.transport;return e.Deferred(function(e){r.trigger(wt,{type:i}),a[i].call(a,Z({success:function(t){e.resolve({response:t,models:n,type:i})},error:function(t,n,i){e.reject(t),r.error(t,n,i)}},t))}).promise()},_send:function(e,t){var n,i,r=this,a=[],o=r.reader.serialize(p(t));if(r.options.batch)t.length&&a.push(r._promise({data:{models:o}},t,e));else for(n=0,i=t.length;i>n;n++)a.push(r._promise({data:o[n]},[t[n]],e));return a},read:function(e){var t=this,n=t._params(e);t._queueRequest(n,function(){t.trigger(wt,{type:"read"})?t._dequeueRequest():(t.trigger(Ct),t._ranges=[],t.transport.read({data:n,success:X(t.success,t),error:X(t.error,t)}))})},success:function(e){var n=this,i=n.options;return n.trigger(kt,{response:e,type:"read"}),e=n.reader.parse(e),n._handleCustomErrors(e)?(n._dequeueRequest(),t):(n._total=n.reader.total(e),n._pristineTotal=n._total,n._aggregate&&i.serverAggregates&&(n._aggregateResult=n.reader.aggregates(e)),e=n._readData(e),n._pristineData=e.slice(0),n._data=n._observe(e),n._addRange(n._data),n._process(n._data),n._dequeueRequest(),t)},_addRange:function(e){var t=this,n=t._skip||0,i=n+t._flatData(e).length;t._ranges.push({start:n,end:i,data:e}),t._ranges.sort(function(e,t){return e.start-t.start})},error:function(e,t,n){this._dequeueRequest(),this.trigger(kt,{}),this.trigger(bt,{xhr:e,status:t,errorThrown:n})},_params:function(e){var t=this,n=Z({take:t.take(),skip:t.skip(),page:t.page(),pageSize:t.pageSize(),sort:t._sort,filter:t._filter,group:t._group,aggregate:t._aggregate},e);return t.options.serverPaging||(delete n.take,delete n.skip,delete n.page,delete n.pageSize),t.options.serverGrouping?t.reader.model&&n.group&&(n.group=A(n.group,t.reader.model)):delete n.group,t.options.serverFiltering?t.reader.model&&n.filter&&(n.filter=O(n.filter,t.reader.model)):delete n.filter,t.options.serverSorting?t.reader.model&&n.sort&&(n.sort=A(n.sort,t.reader.model)):delete n.sort,t.options.serverAggregates?t.reader.model&&n.aggregate&&(n.aggregate=A(n.aggregate,t.reader.model)):delete n.aggregate,n},_queueRequest:function(e,n){var i=this;i._requestInProgress?i._pending={callback:X(n,i),options:e}:(i._requestInProgress=!0,i._pending=t,n())},_dequeueRequest:function(){var e=this;e._requestInProgress=!1,e._pending&&e._queueRequest(e._pending.options,e._pending.callback)},_handleCustomErrors:function(e){if(this.reader.errors){var t=this.reader.errors(e);if(t)return this.trigger(bt,{xhr:null,status:"customerror",errorThrown:"custom error",errors:t}),!0}return!1},_observe:function(e){var t=this,n=t.reader.model,i=!1;return n&&e.length&&(i=!(e[0]instanceof n)),e instanceof Ut?i&&(e.type=t.reader.model,e.wrapAll(e,e)):(e=new Ut(e,t.reader.model),e.parent=function(){return t.parent()}),t._isServerGrouped()&&C(e,n),t._changeHandler&&t._data&&t._data instanceof Ut?t._data.unbind(vt,t._changeHandler):t._changeHandler=X(t._change,t),e.bind(vt,t._changeHandler)},_change:function(e){var t,n,i,r=this,a=e?e.action:"";if("remove"===a)for(t=0,n=e.items.length;n>t;t++)e.items[t].isNew&&e.items[t].isNew()||r._destroyed.push(e.items[t]);!r.options.autoSync||"add"!==a&&"remove"!==a&&"itemchange"!==a?(i=parseInt(r._total||r._pristineTotal,10),"add"===a?i+=e.items.length:"remove"===a?i-=e.items.length:"itemchange"===a||"sync"===a||r.options.serverPaging?"sync"===a&&(i=r._pristineTotal=parseInt(r._total,10)):i=r._pristineTotal,r._total=i,r._process(r._data,e)):r.sync()},_process:function(e,n){var i,r=this,o={};r.options.serverPaging!==!0&&(o.skip=r._skip,o.take=r._take||r._pageSize,o.skip===t&&r._page!==t&&r._pageSize!==t&&(o.skip=(r._page-1)*r._pageSize)),r.options.serverSorting!==!0&&(o.sort=r._sort),r.options.serverFiltering!==!0&&(o.filter=r._filter),r.options.serverGrouping!==!0&&(o.group=r._group),r.options.serverAggregates!==!0&&(o.aggregate=r._aggregate,r._aggregateResult=g(e,o)),i=a.process(e,o),r._view=i.data,i.total===t||r.options.serverFiltering||(r._total=i.total),n=n||{},n.items=n.items||r._view,r.trigger(vt,n)},_mergeState:function(e){var n=this;return e!==t&&(n._pageSize=e.pageSize,n._page=e.page,n._sort=e.sort,n._filter=e.filter,n._group=e.group,n._aggregate=e.aggregate,n._skip=e.skip,n._take=e.take,n._skip===t&&(n._skip=n.skip(),e.skip=n.skip()),n._take===t&&n._pageSize!==t&&(n._take=n._pageSize,e.take=n._take),e.sort&&(n._sort=e.sort=o(e.sort)),e.filter&&(n._filter=e.filter=l(e.filter)),e.group&&(n._group=e.group=c(e.group)),e.aggregate&&(n._aggregate=e.aggregate=u(e.aggregate))),e},query:function(e){var n,i=this,r=i.options.serverSorting||i.options.serverPaging||i.options.serverFiltering||i.options.serverGrouping||i.options.serverAggregates;r||(i._data===t||0===i._data.length)&&!i._destroyed.length?i.read(i._mergeState(e)):i.trigger(wt,{type:"read"})||(i.trigger(Ct),n=a.process(i._data,i._mergeState(e)),i.options.serverFiltering||(i._total=n.total!==t?n.total:i._data.length),i._view=n.data,i._aggregateResult=g(i._data,e),i.trigger(kt,{}),i.trigger(vt,{items:n.data}))},fetch:function(t){var n=this;return e.Deferred(function(e){var i=function(i){n.unbind(bt,r),e.resolve(),t&&t.call(n,i)},r=function(t){e.reject(t)};n.one(vt,i),n.one(bt,r),n._query()}).promise()},_query:function(e){var t=this;t.query(Z({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate()},e))},next:function(e){var n=this,i=n.page(),r=n.total();return e=e||{},!i||r&&i+1>n.totalPages()?t:(n._skip=i*n.take(),i+=1,e.page=i,n._query(e),i)},prev:function(e){var n=this,i=n.page();return e=e||{},i&&1!==i?(n._skip=n._skip-n.take(),i-=1,e.page=i,n._query(e),i):t},page:function(e){var n,i=this;return e!==t?(e=Tt.max(Tt.min(Tt.max(e,1),i.totalPages()),1),i._query({page:e}),t):(n=i.skip(),n!==t?Tt.round((n||0)/(i.take()||1))+1:t)},pageSize:function(e){var n=this;return e!==t?(n._query({pageSize:e,page:1}),t):n.take()},sort:function(e){var n=this;return e!==t?(n._query({sort:e}),t):n._sort},filter:function(e){var n=this;return e===t?n._filter:(n._query({filter:e,page:1}),t)},group:function(e){var n=this;return e!==t?(n._query({group:e}),t):n._group},total:function(){return parseInt(this._total||0,10)},aggregate:function(e){var n=this;return e!==t?(n._query({aggregate:e}),t):n._aggregate},aggregates:function(){return this._aggregateResult},totalPages:function(){var e=this,t=e.pageSize()||e.total();return Tt.ceil((e.total()||0)/t)},inRange:function(e,t){var n=this,i=Tt.min(e+t,n.total());
return!n.options.serverPaging&&n._data.length>0?!0:n._findRange(e,i).length>0},lastRange:function(){var e=this._ranges;return e[e.length-1]||{start:0,end:0,data:[]}},firstItemUid:function(){var e=this._ranges;return e.length&&e[0].data.length&&e[0].data[0].uid},range:function(e,n){var i,r,a,o,s,l,u,c;if(e=Tt.min(e||0,this.total()),i=this,r=Tt.max(Tt.floor(e/n),0)*n,a=Tt.min(r+n,i.total()),o=i._findRange(e,Tt.min(e+n,i.total())),o.length){i._skip=e>i.skip()?Tt.min(a,(i.totalPages()-1)*i.take()):r,i._take=n,s=i.options.serverPaging,l=i.options.serverSorting,u=i.options.serverFiltering,c=i.options.serverAggregates;try{i.options.serverPaging=!0,i._isServerGrouped()||i.group()&&i.group().length||(i.options.serverSorting=!0),i.options.serverFiltering=!0,i.options.serverPaging=!0,i.options.serverAggregates=!0,s&&(i._data=o=i._observe(o)),i._process(o)}finally{i.options.serverPaging=s,i.options.serverSorting=l,i.options.serverFiltering=u,i.options.serverAggregates=c}}else n!==t&&(i._rangeExists(r,a)?e>r&&i.prefetch(a,n,function(){i.range(e,n)}):i.prefetch(r,n,function(){e>r&&a<i.total()&&!i._rangeExists(a,Tt.min(a+n,i.total()))?i.prefetch(a,n,function(){i.range(e,n)}):i.range(e,n)}))},_findRange:function(e,n){var i,r,s,l,u,d,f,h,p,g,m,v,_=this,y=_._ranges,b=[],w=_.options,C=w.serverSorting||w.serverPaging||w.serverFiltering||w.serverGrouping||w.serverAggregates;for(r=0,m=y.length;m>r;r++)if(i=y[r],e>=i.start&&i.end>=e){for(g=0,s=r;m>s;s++)if(i=y[s],p=_._flatData(i.data),p.length&&e+g>=i.start&&(d=i.data,f=i.end,C||(v=c(_.group()||[]).concat(o(_.sort()||[])),h=a.process(i.data,{sort:v,filter:_.filter()}),p=d=h.data,h.total!==t&&(f=h.total)),l=0,e+g>i.start&&(l=e+g-i.start),u=p.length,f>n&&(u-=f-n),g+=u-l,b=_._mergeGroups(b,d,l,u),i.end>=n&&g==n-e))return b;break}return[]},_mergeGroups:function(e,t,n,i){if(this._isServerGrouped()){var r,a=t.toJSON();return e.length&&(r=e[e.length-1]),b(r,a,n,i),e.concat(a)}return e.concat(t.slice(n,i))},skip:function(){var e=this;return e._skip===t?e._page!==t?(e._page-1)*(e.take()||1):t:e._skip},take:function(){return this._take||this._pageSize},_prefetchSuccessHandler:function(e,t,n){var i=this;return function(r){var a,o,s,l=!1,u={start:e,end:t,data:[]};if(i._dequeueRequest(),i.trigger(kt,{response:r,type:"read"}),r=i.reader.parse(r),s=i._readData(r),s.length){for(a=0,o=i._ranges.length;o>a;a++)if(i._ranges[a].start===e){l=!0,u=i._ranges[a];break}l||i._ranges.push(u)}u.data=i._observe(s),u.end=u.start+i._flatData(u.data).length,i._ranges.sort(function(e,t){return e.start-t.start}),i._total=i.reader.total(r),n&&s.length?n():i.trigger(vt,{})}},prefetch:function(e,t,n){var i=this,r=Tt.min(e+t,i.total()),a={take:t,skip:e,page:e/t+1,pageSize:t,sort:i._sort,filter:i._filter,group:i._group,aggregate:i._aggregate};i._rangeExists(e,r)?n&&n():(clearTimeout(i._timeout),i._timeout=setTimeout(function(){i._queueRequest(a,function(){i.trigger(wt,{type:"read"})?i._dequeueRequest():i.transport.read({data:i._params(a),success:i._prefetchSuccessHandler(e,r,n)})})},100))},_rangeExists:function(e,t){var n,i,r=this,a=r._ranges;for(n=0,i=a.length;i>n;n++)if(e>=a[n].start&&a[n].end>=t)return!0;return!1},_removeModelFromRanges:function(e){var t,n,i,r,a;for(r=0,a=this._ranges.length;a>r&&(i=this._ranges[r],this._eachItem(i.data,function(i){t=F(i,e),t&&(n=!0)}),!n);r++);},_updateRangesLength:function(){var e,t,n,i,r=0;for(n=0,i=this._ranges.length;i>n;n++)e=this._ranges[n],e.start=e.start-r,t=this._flatData(e.data).length,r=e.end-t,e.end=e.start+t}}),G={},G.create=function(e,t){var n,i=e.transport;return i?(i.read=typeof i.read===dt?{url:i.read}:i.read,e.type&&(st.data.transports[e.type]&&!et(st.data.transports[e.type])?n=new st.data.transports[e.type](Z(i,{data:t})):i=Z(!0,{},st.data.transports[e.type],i),e.schema=Z(!0,{},st.data.schemas[e.type],e.schema)),n||(n=lt(i.read)?i:new j(i))):n=new q({data:e.data}),n},W.create=function(e){(nt(e)||e instanceof Ut)&&(e={data:e});var t,n,i,r=e||{},a=r.data,o=r.fields,s=r.table,l=r.select,u={};if(a||!o||r.transport||(s?a=E(s,o):l&&(a=z(l,o))),st.data.Model&&o&&(!r.schema||!r.schema.model)){for(t=0,n=o.length;n>t;t++)i=o[t],i.type&&(u[i.field]=i);tt(u)||(r.schema=Z(!0,r.schema,{model:{fields:u}}))}return r.data=a,s=null,r.table=null,r instanceof W?r:new W(r)},J=Vt.define({init:function(e){var t=this,n=t.hasChildren||e&&e.hasChildren,i="items",r={};st.data.Model.fn.init.call(t,e),typeof t.children===dt&&(i=t.children),r={schema:{data:i,model:{hasChildren:n,id:t.idField}}},typeof t.children!==dt&&Z(r,t.children),r.data=e,n||(n=r.schema.data),typeof n===dt&&(n=st.getter(n)),lt(n)&&(t.hasChildren=!!n.call(t,t)),t._childrenOptions=r,t.hasChildren&&t._initChildren(),t._loaded=!(!e||!e[i]&&!e._loaded)},_initChildren:function(){var e,t,n,i=this;i.children instanceof $||(e=i.children=new $(i._childrenOptions),t=e.transport,n=t.parameterMap,t.parameterMap=function(e,t){return e[i.idField||"id"]=i.id,n&&(e=n(e,t)),e},e.parent=function(){return i},e.bind(vt,function(e){e.node=e.node||i,i.trigger(vt,e)}),e.bind(bt,function(e){var t=i.parent();t&&(e.node=e.node||i,t.trigger(bt,e))}),i._updateChildrenField())},append:function(e){this._initChildren(),this.loaded(!0),this.children.add(e)},hasChildren:!1,level:function(){for(var e=this.parentNode(),t=0;e&&e.parentNode;)t++,e=e.parentNode?e.parentNode():null;return t},_updateChildrenField:function(){var e=this._childrenOptions.schema.data;this[e||"items"]=this.children.data()},_childrenLoaded:function(){this._loaded=!0,this._updateChildrenField()},load:function(){var e,n={},i="_query";this.hasChildren?(this._initChildren(),e=this.children,n[this.idField||"id"]=this.id,this._loaded||(e._data=t,i="read"),e.one(vt,X(this._childrenLoaded,this)),e[i](n)):this.loaded(!0)},parentNode:function(){var e=this.parent();return e.parent()},loaded:function(e){return e===t?this._loaded:(this._loaded=e,t)},shouldSerialize:function(e){return Vt.fn.shouldSerialize.call(this,e)&&"children"!==e&&"_loaded"!==e&&"hasChildren"!==e&&"_childrenOptions"!==e}}),$=W.extend({init:function(e){var t=J.define({children:e});W.fn.init.call(this,Z(!0,{},{schema:{modelBase:t,model:t}},e)),this._attachBubbleHandlers()},_attachBubbleHandlers:function(){var e=this;e._data.bind(bt,function(t){e.trigger(bt,t)})},remove:function(e){var t,n=e.parentNode(),i=this;return n&&n._initChildren&&(i=n.children),t=W.fn.remove.call(i,e),n&&!i.data().length&&(n.hasChildren=!1),t},success:H("success"),data:H("data"),insert:function(e,t){var n=this.parent();return n&&n._initChildren&&(n.hasChildren=!0,n._initChildren()),W.fn.insert.call(this,e,t)},_find:function(e,t){var n,i,r,a,o;if(r=W.fn[e].call(this,t))return r;if(a=this._flatData(this.data()))for(n=0,i=a.length;i>n;n++)if(o=a[n].children,o instanceof $&&(r=o[e](t)))return r},get:function(e){return this._find("get",e)},getByUid:function(e){return this._find("getByUid",e)}}),$.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},n=t.data,i=t.fields,r=t.list;return n&&n._dataSource?n._dataSource:(n||!i||t.transport||r&&(n=I(r,i)),t.data=n,t instanceof $?t:new $(t))},K=st.Observable.extend({init:function(e,t,n){st.Observable.fn.init.call(this),this._prefetching=!1,this.dataSource=e,this.prefetch=!n;var i=this;e.bind("change",function(){i._change()}),this._syncWithDataSource(),this.setViewSize(t)},setViewSize:function(e){this.viewSize=e,this._recalculate()},at:function(e){var n,i,r=this.pageSize;return e>=this.total()?(this.trigger("endreached",{index:e}),t):this.useRanges?(this.useRanges&&((this.dataOffset>e||e>this.skip+r)&&(i=Math.floor(e/r)*r,this.range(i)),e===this.prefetchThreshold&&this._prefetch(),e===this.midPageThreshold?this.range(this.nextMidRange):e===this.nextPageThreshold?this.range(this.nextFullRange):e===this.pullBackThreshold&&(this.offset===this.skip?this.range(this.previousMidRange):this.range(this.previousFullRange)),n=this.dataSource.at(e-this.dataOffset)),n===t&&this.trigger("endreached",{index:e}),n):this.dataSource.view()[e]},indexOf:function(e){return this.dataSource.data().indexOf(e)+this.dataOffset},total:function(){return parseInt(this.dataSource.total(),10)},next:function(){var e=this,t=e.pageSize,n=e.skip-e.viewSize,i=Tt.max(Tt.floor(n/t),0)*t+t;this.offset=n,this.dataSource.prefetch(i,t,function(){e._goToRange(n,!0)})},range:function(e){if(this.offset!==e){var t=this,n=this.pageSize,i=Tt.max(Tt.floor(e/n),0)*n+n,r=this.dataSource;this.offset=e,this._recalculate(),r.inRange(e,n)?this._goToRange(e):this.prefetch&&r.prefetch(i,n,function(){t._goToRange(e,!0)})}},syncDataSource:function(){var e=this.offset;this.offset=null,this.range(e)},destroy:function(){this.unbind()},_prefetch:function(){var e=this,t=this.pageSize,n=this.skip+t,i=this.dataSource;i.inRange(n,t)||this._prefetching||!this.prefetch||(this._prefetching=!0,this.trigger("prefetching",{skip:n,take:t}),i.prefetch(n,t,function(){e._prefetching=!1,e.trigger("prefetched",{skip:n,take:t})}))},_goToRange:function(e,t){this.offset===e&&(this.dataOffset=e,this._expanding=t,this.dataSource.range(e,this.pageSize))},_change:function(){var e=this.dataSource,t=e.firstItemUid();this.length=this.useRanges?e.lastRange().end:e.view().length,this._firstItemUid===t&&this.useRanges||(this._syncWithDataSource(),this._recalculate(),this.trigger("reset",{offset:this.offset})),this.trigger("resize"),this._expanding&&this.trigger("expand"),delete this._expanding},_syncWithDataSource:function(){var e=this.dataSource;this._firstItemUid=e.firstItemUid(),this.dataOffset=this.offset=e.skip()||0,this.pageSize=e.pageSize(),this.useRanges=e.options.serverPaging},_recalculate:function(){var e=this.pageSize,t=this.offset,n=this.viewSize,i=Math.ceil(t/e)*e;this.skip=i,this.midPageThreshold=i+e-1,this.nextPageThreshold=i+n-1,this.prefetchThreshold=i+Math.floor(e/3*2),this.pullBackThreshold=this.offset-1,this.nextMidRange=i+e-n,this.nextFullRange=i,this.previousMidRange=t-n,this.previousFullRange=i-e}}),Q=st.Observable.extend({init:function(e,t){var n=this;st.Observable.fn.init.call(n),this.dataSource=e,this.batchSize=t,this._total=0,this.buffer=new K(e,3*t),this.buffer.bind({endreached:function(e){n.trigger("endreached",{index:e.index})},prefetching:function(e){n.trigger("prefetching",{skip:e.skip,take:e.take})},prefetched:function(e){n.trigger("prefetched",{skip:e.skip,take:e.take})},reset:function(){n._total=0,n.trigger("reset")},resize:function(){n._total=Math.ceil(this.length/n.batchSize),n.trigger("resize",{total:n.total(),offset:this.offset})}})},syncDataSource:function(){this.buffer.syncDataSource()},at:function(e){var n,i,r=this.buffer,a=e*this.batchSize,o=this.batchSize,s=[];for(r.offset>a&&r.at(r.offset-1),i=0;o>i&&(n=r.at(a+i),n!==t);i++)s.push(n);return s},total:function(){return this._total},destroy:function(){this.buffer.destroy(),this.unbind()}}),Z(!0,st.data,{readers:{json:V},Query:a,DataSource:W,HierarchicalDataSource:$,Node:J,ObservableObject:qt,ObservableArray:Ut,LocalTransport:q,RemoteTransport:j,Cache:Y,DataReader:V,Model:Vt,Buffer:K,BatchBuffer:Q})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});